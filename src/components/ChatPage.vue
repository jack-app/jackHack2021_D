<template>
  <div class="chatpage">
    <header>
    チャットページ
    <!--  <Logout />-->
    </header>
    <div class="chatpage-text">
    <ChatText v-for = "chattext in chattexts"
      :key ="chattext.key"
      :icon="chattext.icon"
      :name="chattext.name"
      :text="chattext.text"
    />
    </div>
    <div class="chatpage-submit">
      <input type="text" v-model="input">
      <button v-on:click = "doSend" class="btn btn-secondary">送信<i class="fal fa-paper-plane"></i></button>
    </div>
  </div>
</template>
<script>
import ChatText from './ChatText.vue'
//import Logout from './LogoutButton.vue'
import firebase from 'firebase'

export default {
  name: 'ChatPage',
  components:{
    ChatText,
//    Logout
  },
  data: () => ({
    user : {},
    input : "",
    room : "room",
    chattexts:[]
  }),
  created(){
    firebase.auth().onAuthStateChanged(user=>{
      this.user = user ? user : {}
    })
    let ref = firebase.database().ref(this.room+'/message')
    ref.limitToLast(5).on('child_added',this.childAdded)
  },
  methods:{
    childAdded(snap){
      console.log("nya")
      let message=snap.val()
      this.chattexts.push({
        key: snap.key,
        icon: message.icon,
        name: message.name,
        text: message.text,
      })
    },
    doSend(){
      let emotions = this.emotion(this.input);
      console.log({i:emotions})
      let url = this.user.photoURL;
      let encoded = encodeURI(this.user.displayName)
      if(emotions>0){
        url = "https://firebasestorage.googleapis.com/v0/b/emotional-chat-app.appspot.com/o/face%2F"+encoded+"happy.png?alt=media"
      }else if(emotions<0){
        url = "https://firebasestorage.googleapis.com/v0/b/emotional-chat-app.appspot.com/o/face%2F"+encoded+"sad.png?alt=media"
      }
      firebase.database().ref(this.room+'/message').push({
        text: this.input,
        name: this.user.displayName,
        icon: url,
        emotions: emotions
      }, () => {
        this.input = ''
      })
    },
    emotion(message){
      let happy = [
        "嬉しい",
        "楽しい",
        "やった",
        "！",
        "w",
        "アゲアゲ",
        "いいね",
        "イエーイ",
        "エネルギッシュ",
        "おもしろい",
        "かわいい",
        "キュート",
        "きれい",
        "グッド",
        "スッキリ",
        "ツイテル",
        "テンションが上がる",
        "ドキドキ",
        "ノリノリ",
        "パワフル",
        "ヒーリング",
        "プラスの感情",
        "ほっとする",
        "ほほえむ",
        "ほめる",
        "やる気がある",
        "ラッキー",
        "リラックス",
        "わくわく",
        "わらう",
        "愛",
        "愛してる",
        "安心",
        "安全",
        "安堵",
        "意欲的",
        "華やか",
        "快適",
        "懐かしい",
        "楽しい",
        "活気",
        "活躍",
        "活力",
        "感激",
        "感心",
        "感動",
        "嬉しい",
        "希望",
        "気持ちいい",
        "気分爽快",
        "興奮する",
        "健康",
        "元気",
        "誇り",
        "光",
        "好き",
        "幸せ",
        "幸福",
        "高ぶる",
        "最高",
        "思いやりがある",
        "自信",
        "勝利",
        "笑",
        "笑う",
        "上手い",
        "信念",
        "信頼",
        "成功",
        "成長",
        "正義",
        "積極的",
        "絶好調",
        "前進",
        "全力",
        "爽やか",
        "爽快",
        "尊敬",
        "尊敬する",
        "大好き",
        "大爆笑",
        "暖かい",
        "憧れる",
        "得意",
        "賑やか",
        "爆笑",
        "飛躍",
        "美味しい",
        "平気",
        "平和",
        "本気",
        "満足",
        "夢",
        "明るい",
        "面白い",
        "愉快",
        "癒される",
        "癒し",
        "優しい",
        "勇気",
        "陽気",
        "落ち着く",
        "良好",
        "恋してる",
        "和む",
        "ありがとう",
        "ドンマイ",
        "良い",
        "素晴らしい",
        "素敵",
        "感謝します",
        "信じてる",
        "協力しよう",
        "美しい",
        "おめでとう",
        "流石",
        "しょうがない",
        "尊敬します",
        "大丈夫",
        "あなたなら出来る",
        "ユニーク",
        "ユーモアがあるね",
        "センスが良い",
        "あなたしか出来ない",
        "期待している",
        "信頼している",
        "助かりた",
        "あなたのおかげ",
        "よろしくね",
        "愛してます",
        "きれいだね",
        "あなたがいてよかった",
        "うまくいく",
        "できる",
        "なんとかなる",
        "まあいっか",
        "道は開ける",
        "解決できる",
        "ハッピー",
        "夢は叶う",
        "努力は報われる",
        "実を結ぶ",
        "花が咲く",
        "期待通り",
        "思い通り",
        "問題はない",
        "想像以上",
        "得意気",
        "興奮",
        "喜び",
        "生きてる",
        "夢中の",
        "大喜び",
        "至福",
        "ウキウキ",
        "狂喜",
        "陶酔",
        "びっくり",
        "喜んで",
        "陽気な",
        "嬉々",
        "歓楽",
        "満悦",
        "朗らか",
        "活気に満ちた",
        "意気揚々",
        "輝かしい",
        "意気揚揚",
        "飛び跳ねる",
        "お祝い",
        "うれしさ",
        "うっとり",
        "光り輝く",
        "気軽",
        "調子の良い",
        "高める",
        "泡立つ",
        "楽観的",
        "粋",
        "興味がある",
        "驚いた",
        "畏怖",
        "凛々しい",
        "魅了",
        "やる気",
        "熱狂",
        "発奮",
        "刺激",
        "移動",
        "凄まじい",
        "滑稽",
        "陽気な",
        "にこやか",
        "コミカル",
        "軽妙",
        "遊び",
        "魅力的",
        "切実",
        "拍手喝采",
        "賛美",
        "熱心な",
        "著名",
        "畏敬の念",
        "とろける",
        "魅惑",
        "誘惑",
        "じれったい",
        "招待",
        "奇妙な",
        "知りたい",
        "触れます",
        "仰天",
        "気配り",
        "興味をそそる",
        "好ましい",
        "はつらつ",
        "ファンタスティック",
        "センセーショナル",
        "爆発的",
        "通電",
        "心温まる",
        "影響力のある",
        "腕利き",
        "包み込む",
        "豊か",
        "豊かな",
        "先駆的",
        "信じられない",
        "カラフル",
        "人目を引く",
        "芸術的",
        "おいしい",
        "食欲をそそる",
        "ヨダレがたれそうな",
        "インテリジェント",
        "新奇",
        "莫大",
        "香ばしい",
        "豪華な",
        "無制限",
        "革新的",
        "タイムリーな",
        "神秘的",
        "魔法の",
        "愛する",
        "共感",
        "愛らしい",
        "感嘆",
        "敬う",
        "お手入れ",
        "献身的",
        "畏敬",
        "忠実な",
        "ロイヤル",
        "コミットメント",
        "献身",
        "愛想のいい",
        "カリスマ",
        "好かれます",
        "支援",
        "エンパワーメント",
        "隆起",
        "有用",
        "同情的",
        "理解",
        "種類",
        "収容",
        "近づきやすい",
        "尊敬すべき",
        "快い",
        "丁重",
        "敬意",
        "丁寧",
        "協同組合",
        "情け深い",
        "優雅な",
        "慾望",
        "チャリティ",
        "官能的",
        "誠意",
        "甘味",
        "寛容な",
        "雅量",
        "暖かさ",
        "他愛",
        "忠誠",
        "ロマンチック",
        "渇き",
        "食欲",
        "夢中",
        "ノーブル",
        "調和のとれた",
        "慈悲深い",
        "道徳の",
        "正直な",
        "尽きることのない",
        "繁盛",
        "強",
        "望ましい",
        "穏やか",
        "守られた",
        "要塞",
        "陽性",
        "望む",
        "信仰",
        "謙虚",
        "インスピレーションを得た",
        "決定",
        "気力",
        "解決",
        "機知",
        "執念",
        "不動",
        "勤勉",
        "固執",
        "信頼性",
        "不屈",
        "度胸",
        "主張",
        "思いやりのある",
        "熱意",
        "冒険",
        "動じない",
        "意",
        "勇決",
        "大胆",
        "耐久",
        "タフ",
        "揺るぎない",
        "根気",
        "熱烈",
        "成功した",
        "渇望",
        "大胆さ",
        "適合",
        "理想主義的",
        "表情豊かな",
        "効率",
        "確実",
        "歓迎",
        "できます",
        "ウィリング",
        "不敵",
        "独創性",
        "巧み",
        "準備",
        "装備",
        "教育を受けた",
        "強化された",
        "アクティブ",
        "動的",
        "強い",
        "創造的",
        "高信頼",
        "不可欠",
        "親切な",
        "親切",
        "のんきな",
        "首尾一貫した",
        "進化",
        "プログレッシブ",
        "出芽",
        "便利",
        "適切な",
        "適当",
        "驚くばかり",
        "十分な",
        "承認",
        "一定",
        "明敏な",
        "聞き分け",
        "解放さ",
        "異例",
        "気が利きます",
        "教えやすい",
        "温帯",
        "ぐらつきない",
        "注意深い",
        "資格のある",
        "整然とした",
        "慎重な",
        "几帳面",
        "支持した",
        "多彩な",
        "真実な",
        "表彰",
        "救済",
        "静けさ",
        "平穏",
        "静か",
        "感謝",
        "鑑賞的",
        "履行",
        "完成",
        "観想",
        "実現",
        "休み",
        "残り",
        "離脱する",
        "いたずら",
        "保護された",
        "保証",
        "セキュリティ",
        "シェルター",
        "特権",
        "自由",
        "解放",
        "独立",
        "団結",
        "感傷",
        "楽しみ",
        "ノスタルジック",
        "おもしろおかしい",
        "密度の濃い",
        "禅",
        "瞑想",
        "伸び伸び",
        "許し",
        "礼儀",
        "善意",
        "希望的観測",
        "価値",
        "敏感",
        "意識",
        "受容",
        "静かな",
        "啓示",
        "受諾",
        "内省",
        "正真正銘",
        "公正",
        "幻の",
        "受け入れ",
        "信憑性",
        "繁栄しています",
        "やりがい",
        "再生された",
        "癒さ",
        "現在",
        "幸運な",
        "純正",
        "好ま",
        "安定",
        "自立",
        "涼しい",
        "やはり",
        "落ち着いた",
        "欲しい",
        "ゆったり",
        "大切",
        "十分",
        "多才",
        "洗練",
      ];
      let sad = [
        "悲しい",
        "辛い",
        "残念",
        "あーあ",
        "いじめ",
        "いたずら",
        "いたずらな",
        "イライラ",
        "うるさい",
        "うろたえる",
        "うんざり",
        "えー…",
        "おどおど",
        "おびえ",
        "おびえる",
        "お化け",
        "お粗末",
        "ガタガタ",
        "がっかり",
        "がっくり",
        "カットダウン",
        "かゆい",
        "かわいそう",
        "ぎこちない",
        "キモい",
        "くそ",
        "くだらない",
        "グレー",
        "クレージー",
        "グロい",
        "クロス",
        "ごみ",
        "ゴミ",
        "コントロールを失う",
        "さびれ",
        "さらに悪いことに",
        "シニカル",
        "すねた",
        "スロー",
        "ぞっと",
        "ダウン",
        "だまされる",
        "ためらいがちな",
        "だれる",
        "チキン",
        "つまらない",
        "つまんない",
        "つらい",
        "できない",
        "とげとげしい",
        "ドライな",
        "とんでもない",
        "ナーバス",
        "ねじ込み",
        "のけ者",
        "のろわれた",
        "ハード",
        "ばかげた",
        "バカにされる　",
        "ばかばかしい",
        "パニック",
        "ハングアップ",
        "ぴえん",
        "ヒステリック",
        "びっくりした",
        "ひどい",
        "ファウル",
        "ふまじめ",
        "ブラック",
        "ブラックリストに載って",
        "ブルー",
        "プレッシャー",
        "ヘコむ",
        "へらへら",
        "ボーッ",
        "ホームレス",
        "ぼかし",
        "ホット",
        "ホラー",
        "マッド",
        "みだらな",
        "むっと",
        "めまい",
        "メランコリック",
        "もつれ",
        "やけくそ",
        "ややこしい",
        "リスクの",
        "レイプ",
        "わびしい",
        "哀しい",
        "哀れ",
        "愛されていない",
        "愛のない",
        "悪い",
        "悪の",
        "悪化",
        "圧倒",
        "圧倒される",
        "安っぽい",
        "安全でない",
        "闇",
        "依存",
        "意気消沈",
        "意地の悪い",
        "意地悪",
        "慰められない",
        "萎え",
        "萎える",
        "萎縮",
        "違反",
        "一人で",
        "因業",
        "引きこもっ",
        "引き裂く",
        "陰気",
        "嘘をつきた",
        "嘘をつく",
        "運命",
        "厭世家",
        "遠く",
        "汚い",
        "汚れた",
        "横柄な",
        "臆病な",
        "下ろし",
        "過大",
        "過敏な",
        "回避",
        "回避します",
        "壊れた",
        "悔しい",
        "割れ目",
        "勘当",
        "感情",
        "感情の",
        "間違い",
        "間違いた",
        "危険な",
        "奇怪",
        "奇矯",
        "奇妙",
        "奇妙な",
        "嬉しいわけない",
        "嬉しくない",
        "忌み嫌う",
        "気が狂う",
        "気にされない",
        "気に入らな",
        "気難しい",
        "偽",
        "偽物",
        "欺か",
        "疑う",
        "疑わしい",
        "疑問",
        "義務",
        "虐げ",
        "虐待",
        "虐待された",
        "泣ける",
        "拒否された",
        "競争の",
        "共依存",
        "凶悪な",
        "強制",
        "強盗",
        "強迫",
        "強要",
        "恐れ",
        "恐ろしい",
        "恐怖",
        "狭苦しい",
        "脅かされ",
        "脅迫",
        "極寒",
        "禁止された",
        "苦い",
        "苦しい",
        "苦しみ",
        "苦しめ",
        "苦笑",
        "苦悩",
        "苦悩に満ちた",
        "愚か",
        "愚かな",
        "空っぽ",
        "空腹の",
        "屈辱",
        "軽視",
        "軽蔑",
        "軽率",
        "劇的",
        "撃退",
        "激しい",
        "激怒",
        "欠いた",
        "欠陥",
        "欠損",
        "嫌",
        "嫌い",
        "嫌がらせ",
        "嫌な",
        "嫌わ",
        "嫌悪",
        "見下す",
        "厳しい",
        "幻滅",
        "限られた",
        "孤独",
        "孤立",
        "戸建",
        "戸惑う",
        "故障",
        "枯渇",
        "顧みられない",
        "後悔",
        "誤解",
        "誤解された",
        "効果がありない",
        "口が軽い",
        "好戦",
        "慌しい",
        "攻撃",
        "更年期",
        "荒廃",
        "荒涼",
        "高慢",
        "合わない",
        "酷い",
        "骨抜き",
        "困って",
        "困る",
        "困惑",
        "恨む",
        "根暗",
        "混雑",
        "混沌",
        "混乱",
        "罪悪感",
        "搾取",
        "殺風景",
        "惨め",
        "思い上がり",
        "支配",
        "死ぬ",
        "死んだ",
        "事故",
        "事前に判断",
        "自虐",
        "自己嫌悪",
        "自己中心的な",
        "自己破壊的",
        "自殺",
        "自分勝手",
        "自慢の",
        "失われた",
        "失望",
        "失望させる",
        "嫉妬",
        "質問さ",
        "捨てられた",
        "捨てる",
        "邪悪",
        "邪険",
        "邪魔",
        "寂しい",
        "弱い",
        "取りつかれ",
        "取り残す",
        "取り乱す",
        "受け入れられない",
        "受動的",
        "終始",
        "処罰",
        "所属していない",
        "除外",
        "傷つい",
        "傷跡",
        "娼婦",
        "小さい",
        "少し",
        "消費",
        "焼け",
        "焦る",
        "衝動的な",
        "場違いの",
        "常軌を逸した",
        "常識に欠ける",
        "情けない",
        "心が痛む",
        "心細い",
        "心配",
        "心配して",
        "心配している",
        "心配してる",
        "深い",
        "神経症",
        "神秘的",
        "診断",
        "辛い",
        "人工的な",
        "水切り",
        "酔っぱら",
        "制御",
        "制御不能",
        "性急な",
        "精神病",
        "静か",
        "脆い",
        "脆弱",
        "惜しむ",
        "石化",
        "切ない",
        "切り下げ",
        "切断",
        "接地",
        "説教",
        "絶望",
        "絶望しています",
        "絶滅の危機に瀕",
        "浅ましい",
        "繊細",
        "羨ましい",
        "選びた",
        "選抜アウト",
        "疎外",
        "素直",
        "阻害",
        "操作",
        "争い好き",
        "憎い",
        "憎しみ",
        "憎む",
        "息ができない",
        "息苦しい",
        "存在しない",
        "損傷",
        "堕落した",
        "打たれた",
        "打ちのめさ",
        "駄目",
        "体にぴったり",
        "怠惰",
        "退屈",
        "退屈な",
        "台無し",
        "大嫌いな",
        "奪われた",
        "恥ずかしい",
        "恥ずべき",
        "恥をかく",
        "窒息死",
        "中傷",
        "中断された",
        "中毒",
        "挑戦的な",
        "挑発",
        "跳ねる",
        "鎮圧",
        "追いつめ",
        "追い出され",
        "追われる",
        "追放",
        "痛い",
        "痛み",
        "低い",
        "敵意のあります",
        "展示中",
        "途方に暮れて",
        "奴隷",
        "怒り",
        "怒りた",
        "投獄",
        "盗聴",
        "動揺",
        "憧れ",
        "鈍い",
        "内向",
        "燃え尽きる",
        "悩ましい",
        "破壊",
        "破壊的",
        "破砕された",
        "廃棄",
        "廃棄された",
        "敗北",
        "薄情な",
        "判別",
        "反対",
        "反発",
        "悲しい",
        "悲しみ",
        "悲しみに襲わ",
        "悲観的",
        "悲愴",
        "批判",
        "疲れ",
        "疲れた",
        "皮相",
        "皮肉な",
        "被害を受け",
        "被告",
        "非活性",
        "非効率的な",
        "非常識",
        "非難",
        "鼻息が荒い",
        "必死の",
        "必要ない",
        "病気",
        "貧しい",
        "敏感",
        "不安",
        "不快",
        "不快な",
        "不完全",
        "不器用",
        "不機嫌",
        "不気味",
        "不気味な",
        "不均衡",
        "不合理",
        "不十分",
        "不十分な",
        "不承認",
        "不祥事を起こした",
        "不信心",
        "不人情",
        "不正直",
        "不注意な",
        "不適合",
        "不備",
        "不満",
        "不明確",
        "不毛",
        "不愉快",
        "不要な",
        "怖い",
        "負",
        "負い目",
        "負傷者",
        "負担",
        "侮辱",
        "復讐",
        "腹を立てて",
        "憤慨",
        "憤慨して",
        "閉まっている",
        "閉口",
        "閉所恐怖症",
        "偏見",
        "保護されていない",
        "保守的",
        "呆れる",
        "方向性",
        "飽きた",
        "忘れっぽい",
        "忘れやすい",
        "忙しい",
        "暴行",
        "暴露",
        "麻痺",
        "未承認",
        "無関心",
        "無気力",
        "無効",
        "無効化",
        "無視",
        "無責任な",
        "無知",
        "無秩序",
        "無能な",
        "無防備",
        "無力な",
        "命じ",
        "紋切り型",
        "役に立ちない",
        "憂欝",
        "憂思",
        "憂鬱",
        "有罪",
        "有罪判決を受けた",
        "誘惑",
        "抑制",
        "落ち込む",
        "落ち込んで",
        "落ち着かない",
        "落胆",
        "乱打",
        "利己的",
        "理屈っぱい",
        "裏切",
        "裏返しアウト",
        "立ち往生",
        "冷たい",
        "冷やか",
        "劣化",
      ];
      let happiness = 0;
      let sadness = 0;
      happy.forEach((word) => {
        if(message.indexOf(word)!==-1){
          happiness++;
        }
      });
      sad.forEach((word) => {
        if(message.indexOf(word)!==-1){
          sadness++;
        }
      });
      //return {happiness: happiness, sadness: sadness}
      return happiness - sadness
    }
  }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
 .chatpage{
 background-color:;
 font-weight:600;
 height:;
 }
  header{
  background-color:#78FF94;
  color:white;
  height:40px;
  line-height:40px;
  opacity:0.8;
  position:fixed;
  width:100%;
  }

  .chatpage-text{
  padding:40px;
  min-width:450px;
  margin:0 auto;
  padding-bottom:45px;
  justify-content:space-around;
  }
  .chatpage-submit{
  position:fixed;
  margin:0 auto;
  padding-bottom: 20px;
  width:100%;
  bottom:0;
  background-color:white;
  opacity:0.8;
  }

</style>
